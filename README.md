# BPMN 2.0 Diagram Generator

Веб-приложение для генерации BPMN 2.0 диаграмм по текстовому описанию.

## Возможности

- ✅ Генерация BPMN диаграмм из JSON описания
- ✅ Поддержка swimlanes (горизонтальные дорожки по ролям)
- ✅ Элементы BPMN 2.0: события (start/end), задачи, подпроцессы, XOR/AND/OR-шлюзы
- ✅ Кросс-дорожечные связи без пересечений
- ✅ Возвратные стрелки (циклы) - идут сверху, не пересекая основной поток
- ✅ Подписи на всех развилках шлюзов
- ✅ Цветовая кодировка элементов и дорожек
- ✅ Экспорт в PNG/SVG/PDF/JSON
- ✅ JSON редактор для прямого редактирования структуры
- ✅ Готовые примеры диаграмм

## Установка

```bash
npm install
```

## Запуск

```bash
npm run dev     # Режим разработки
npm run build   # Продакшн сборка
npm run preview # Предпросмотр сборки
```

## Формат входных данных

Приложение принимает JSON описание диаграммы в следующем формате:

```json
{
  "name": "Согласование договора",
  "lanes": [
    { "id": "lane-author", "name": "Автор", "color": "#58a6ff" },
    { "id": "lane-system", "name": "Система", "color": "#7ee787" },
    { "id": "lane-approver", "name": "Согласующий", "color": "#a371f7" }
  ],
  "elements": [
    { "id": "start", "type": "startEvent", "label": "Начало", "lane": "lane-author" },
    { "id": "t1", "type": "task", "label": "Создать договор", "lane": "lane-author" },
    { "id": "g1", "type": "xorGateway", "label": "Тип договора?", "lane": "lane-author" }
  ],
  "flows": [
    { "from": "start", "to": "t1" },
    { "from": "g1", "to": "t2", "label": "Поставка" },
    { "from": "g1", "to": "t3", "label": "Услуги" },
    { "from": "t8", "to": "t2", "type": "return" }
  ]
}
```

### Типы элементов

| Тип | Описание |
|-----|----------|
| `startEvent` | Событие начала (зелёный круг) |
| `endEvent` | Событие конца (красный круг) |
| `intermediateEvent` | Промежуточное событие (жёлтый круг) |
| `task` | Задача (прямоугольник) |
| `subprocess` | Подпроцесс (прямоугольник с иконкой) |
| `xorGateway` | XOR шлюз - исключающее ИЛИ (ромб с X) |
| `parallelGateway` | AND шлюз - параллельный (ромб с +) |
| `inclusiveGateway` | OR шлюз - включающее ИЛИ (ромб с O) |

### Параметры потоков (flows)

| Параметр | Описание |
|----------|----------|
| `from` | ID исходного элемента |
| `to` | ID целевого элемента |
| `label` | Подпись на стрелке (опционально) |
| `type` | `"return"` для возвратных стрелок (опционально) |

## Структура проекта

```
src/
├── components/
│   ├── BPMNShapes/          # SVG компоненты BPMN элементов
│   │   ├── BPMNShapes.jsx   # Элементы: события, задачи, шлюзы
│   │   └── FlowConnection.jsx # Соединительные линии
│   ├── DiagramCanvas/       # Холст диаграммы
│   ├── ExportPanel/         # Панель экспорта
│   ├── Header/              # Шапка приложения
│   ├── JsonEditor/          # JSON редактор
│   └── Sidebar/             # Боковая панель структуры
├── data/
│   └── sampleDiagrams.js    # Примеры диаграмм
├── engine/
│   └── layoutEngine.js      # Алгоритм автолейаута
├── App.jsx                  # Главный компонент
└── main.jsx                 # Точка входа
```

## Технологии

- React 19
- Vite 6
- html-to-image (экспорт в PNG/SVG)
- jsPDF (экспорт в PDF)
- Кастомный SVG рендеринг
- Кастомный алгоритм лейаута (топологическая сортировка + оптимизация)

## Примеры диаграмм

Приложение включает 3 готовых примера:

1. **Согласование договора** - полный процесс с ветвлениями и возвратными стрелками
2. **Обработка заказа** - процесс с 4 дорожками и параллельными шлюзами  
3. **Простой процесс** - базовый линейный пример

## Особенности алгоритма лейаута

- Топологическая сортировка для определения порядка элементов слева направо
- Группировка элементов по колонкам
- Автоматический расчёт высоты дорожек
- Ортогональные связи со скруглёнными углами
- Возвратные стрелки идут сверху, не пересекая основной поток
- Метки на связях позиционируются автоматически

## Экспорт

- **PNG** - растровое изображение (качество 1x/2x/3x)
- **SVG** - векторный формат
- **PDF** - документ
- **JSON** - данные диаграммы для импорта

## Планы развития

- [ ] Drag & drop редактирование элементов
- [ ] Парсинг естественного языка через LLM
- [ ] Импорт/экспорт в стандартный формат BPMN XML
- [ ] Улучшение алгоритма минимизации пересечений
- [ ] Поддержка дополнительных элементов BPMN 2.0

# BPMN 2.0 Composer

Веб-приложение для генерации BPMN 2.0 диаграмм по текстовому описанию.

## Возможности

- ✅ Генерация BPMN диаграмм из JSON описания
- ✅ Поддержка swimlanes (горизонтальные дорожки по ролям)
- ✅ Элементы BPMN 2.0: события (start/end), задачи, подпроцессы, XOR/AND-шлюзы
- ✅ Кросс-дорожечные связи
- ✅ Возвратные стрелки (циклы)
- ✅ Подписи на всех развилках шлюзов
- ✅ Цветовая кодировка элементов
- ✅ Экспорт в PNG/SVG/PDF

## Установка

```bash
npm install
```

## Запуск

```bash
npm run dev
```

## Формат входных данных

Приложение принимает JSON описание диаграммы в следующем формате:

```json
{
  "lanes": ["Автор", "Система", "Согласующий"],
  "elements": [
    {
      "id": "start",
      "type": "startEvent",
      "label": "Начало",
      "lane": "Автор"
    },
    {
      "id": "t1",
      "type": "task",
      "label": "Создать договор",
      "lane": "Автор"
    },
    {
      "id": "g1",
      "type": "xorGateway",
      "label": "Изменить?",
      "lane": "Автор"
    }
  ],
  "flows": [
    {
      "from": "start",
      "to": "t1"
    },
    {
      "from": "g1",
      "to": "t2",
      "label": "Да",
      "return": true
    }
  ]
}
```

### Типы элементов

- `startEvent` - Событие начала
- `endEvent` - Событие конца
- `task` - Задача
- `subProcess` - Подпроцесс
- `xorGateway` - XOR шлюз
- `andGateway` - AND шлюз
- `orGateway` - OR шлюз

### Типы потоков

- `from` - ID исходного элемента
- `to` - ID целевого элемента
- `label` - Подпись на стрелке (опционально)
- `return` - Флаг возвратной стрелки (опционально)
- `animated` - Анимация стрелки (опционально)

## Структура проекта

```
src/
  bpmn/
    components/       # React компоненты
      BpmnComposer.jsx    # Главный компонент
      BpmnCanvas.jsx      # Canvas для отображения диаграммы
      Swimlanes.jsx       # Компонент swimlanes
      ExportPanel.jsx     # Панель экспорта
    nodes/            # Кастомные узлы BPMN
      BpmnStartNode.jsx
      BpmnEndNode.jsx
      BpmnTaskNode.jsx
      BpmnGatewayNode.jsx
      BpmnSubProcessNode.jsx
    parser.js         # Парсер JSON описания
    layout.js         # Алгоритм компоновки
```

## Технологии

- React 19
- React Flow (@xyflow/react)
- Dagre (алгоритм компоновки графов)
- html2canvas (экспорт в PNG)
- jsPDF (экспорт в PDF)

## MVP

Текущая версия включает:
1. Хардкод примера диаграммы согласования договора
2. Автоматическая компоновка с поддержкой swimlanes
3. Экспорт в PNG/PDF/SVG

## Планы развития

- [ ] UI для редактирования структуры диаграммы
- [ ] Парсинг естественного языка в структуру (LLM)
- [ ] Улучшение алгоритма компоновки для минимизации пересечений
- [ ] Поддержка дополнительных элементов BPMN
- [ ] Импорт/экспорт в стандартный формат BPMN XML
